## 21.2 Микросервисы: принципы - Вячеслав Закариев

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

### Задача 1: API Gateway 

Предложите решение для обеспечения реализации API Gateway. Составьте сравнительную таблицу возможностей различных программных решений. На основе таблицы сделайте выбор решения.

Решение должно соответствовать следующим требованиям:
- маршрутизация запросов к нужному сервису на основе конфигурации,
- возможность проверки аутентификационной информации в запросах,
- обеспечение терминации HTTPS.

Обоснуйте свой выбор.

### Задача 2: Брокер сообщений

Составьте таблицу возможностей различных брокеров сообщений. На основе таблицы сделайте обоснованный выбор решения.

Решение должно соответствовать следующим требованиям:
- поддержка кластеризации для обеспечения надёжности,
- хранение сообщений на диске в процессе доставки,
- высокая скорость работы,
- поддержка различных форматов сообщений,
- разделение прав доступа к различным потокам сообщений,
- простота эксплуатации.

Обоснуйте свой выбор.

---

### Решение 1

Для оценки выбраны следующие API-шлюзы:
1. **Kong** - один из популярных облачный API-шлюзов с открытым исходным кодом, построенный поверх облегченного прокси.
2. **KrakenD** - высокопроизводительный API-шлюз с открытым исходным кодом.
3. **Tyk** - API-шлюз с открытым исходным кодом на выбор: автономный или управляемый.
4. **Nginx** - производительный, масштабируемый, также используется в качестве API gateway благодаря возможностям настройки.
5. **Gloo Edge** - многофункциональный встроенный в Kubernetes входной контроллер и API-шлюз.


| Правило сравнения      |             Kong            |           KrakenD           |          Tyk            |        Nginx         |        Gloo Edge        |
|------------------------|-----------------------------|-----------------------------|-------------------------|----------------------|-------------------------|
| Язык разработки        | Lua                         | Go                          | Go                      | C                    | Go                      |
| Аутентификация         | Есть                        | Есть                        | Есть                    | Есть                 | Есть                    |
| Терминация HTTPS       | Есть                        | Есть                        | Есть                    | Есть                 | Есть                    |
| Композиция данных      | Нет                         | Есть                        | Есть                    | Нет                  | Нет                     |
| База данных            | PostgreSQL                  | Собственная БД              | Redis                   | Файловое             | Собственная БД          |
| GraphQL                | Есть                        | Есть                        | Есть                    | Нет                  | Есть                    |

Подбор шлюза согласно задаче:
1. Для простых задач вполне подойдет Nginx, данный продукт имеет в арсенале возможности балансировки трафика, терминацию https и проверку аутентификации.
2. Для высоконагруженных систем, требующих обработки большого объёма трафика, подойдёт KrakenD. Продукт имеет богатый функционал, а также на сегодняшний день имеет самую большую производительность из известных API-шлюзов.
3. Также имеется платные варианты шлюзов у облачных провадеров в виде отдельной услуги AWS, Azure и Yandex, которые показали свою эффективность в работе с облачными сервисами.
