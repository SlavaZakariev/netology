## 21.4 Микросервисы: масштабирование - Вячеслав Закариев

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры. \
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

### Задача 1: Кластеризация

Предложите решение для обеспечения развёртывания, запуска и управления приложениями.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- поддержка контейнеров;
- обеспечивать обнаружение сервисов и маршрутизацию запросов;
- обеспечивать возможность горизонтального масштабирования;
- обеспечивать возможность автоматического масштабирования;
- обеспечивать явное разделение ресурсов, доступных извне и внутри системы;
- обеспечивать возможность конфигурировать приложения с помощью переменных среды, в том числе с возможностью безопасного хранения чувствительных данных таких как пароли, ключи доступа, ключи шифрования и т. п.

Обоснуйте свой выбор.

---

### Решение 1

Нарисована схема на [draw.io](https://www.drawio.com/) для домена вымышленного интернет магазина - `одежда.рф`

![arch](https://github.com/SlavaZakariev/netology/blob/b99f96056b5ca911d4b3aef42c39ace7e23efb37/microservices/21.4_scaling/resources/micro_4.1.jpg)

Описание схемы:

1. Сегментируем сеть для сопутствующих ресурсов **vLan1** - `192.168.1.0/24` и для Кубернетеса отдельный **vLan2** - `192.168.2.0/24`
2. В сопутствующие ресурсы включаем, независимые виртуальные машины на **ОС Linux**:
   - **GitLab** с **GitLab Registry** и **CI\CD**
   - **GitLab Runner**
   - Систему сбора логов - кластер **ELK**
   - Систему визуализации логов - мониторинг **Grafana**
   - СУБД - кластер **PostgreSQL**
3. Для размещения приложения и возможности горизонтального масштабирования и автоматического масштабирования, организовываем площадку из 8 виртуальных машин на **ОС Linux** и собираем кластер Кубернетес:
   - 3 сервера - workers для размещения контейнеров
   - 3 сервера - masters для централизованного контроля кластером
   - 2 сервера - ingress для проксирования трафика на контейнеры внутри Кубернетеса
4. Собираем отказоустойчивый кластер балансировщика на открытом ПО **HAProxy** из 2 виртуальных машин на **ОС Linux** c **keepalived** и выделением белого **VIP IP-адреса**. Размещение централизованного отказоустойчивого балансировщика поможет настроить единую точку шифрования **SSL** трафика при наличии **wildcard** для домена `*.одежда.рф` и опубликовать наружу различные приложения развёртнутые внутри Кубернетес.
