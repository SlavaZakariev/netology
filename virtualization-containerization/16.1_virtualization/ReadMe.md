## Введение в виртуализацию - Вячеслав Закариев

### Цели задания
1. Научиться запускать виртуальную машину в Yandex Cloud с минимальным расходом ресурсов.
2. Попрактиковаться в выборе платформы  и системы управления виртуализации для решения требуемых задач.

### Инструкция к выполению

1. Для выполнения задачи 1 ознакомьтесь с [инструкцией](https://github.com/netology-code/devops-materials/blob/master/cloudwork.MD) по экономии облачных ресурсов и затем выполните задачу 1 по шагам.
2. Своё решение к задачам 2,3,4 загрузите  в ваш ЛК.

## Задача 1

Ознакомьтесь с [инструкцией ](https://github.com/netology-code/devops-materials/blob/master/cloudwork.MD) по экономии облачных ресурсов.

1. Создайте через web-интерфейс Yandex Cloud - VPC и виртуальную машину из инструкции конфигурации "эконом-ВМ" с публичным ip-адресом. В пункте "Выбор образа/загрузочного диска" выберите вкладку "Cloud Marketplace" , щелкните "Посмотреть больше", найдите образ "Yandex Cloud Toolbox".
2. Убедитесь, что вы можете подключиться к консоли ВМ через ssh, используя публичный ip-адрес. Убедитесь, что на ВМ установлен Docker с помощью команды ```docker --version```(команду выполните от имени root пользователя) !
3. Узнайте в инструкции Яндекс, какие еще инструменты предустановлены в данном образе.
4. Оставьте ВМ работать, пока она не выключится самостоятельно! Опция "прерываемая" выключит ее не позже чем через 24 часа. 
5. Для наглядности подождите еще 1 сутки.
6. Перейдите по [ссылке ](https://console.cloud.yandex.ru/billing?section=accounts). Выберите свой платежный аккаунт. Перейдите на вкладку детализация (фильтр "По продуктам") и оцените график потребления финансов.
7. Удалите ВМ или пользуйтесь ею при выполнении последующих домашних заданий курса обучения.

---

## Решение 1

1. Создана ВМ на Yandex Cloud

![virt1](https://github.com/SlavaZakariev/netology/blob/e519d31aa6201bc64b5b96a3ecb41c0810c85a09/virtualization-containerization/16.1_virtualization/resources/virt_1.1.jpg)

2. Выполнено подключение по **SSH ED25519**, проверены предустановленные приложения на **Yandex Cloud Toolbox**

![virt2](https://github.com/SlavaZakariev/netology/blob/e519d31aa6201bc64b5b96a3ecb41c0810c85a09/virtualization-containerization/16.1_virtualization/resources/virt_1.2.jpg)

3. Детализация по продуктам

![virt3](https://github.com/SlavaZakariev/netology/blob/e519d31aa6201bc64b5b96a3ecb41c0810c85a09/virtualization-containerization/16.1_virtualization/resources/virt_1.3.jpg)

---

## Задача 2

Выберите один из вариантов платформы в зависимости от задачи. Здесь нет однозначно верного ответа так как все зависит от конкретных условий: финансирование, компетенции специалистов, удобство использования, надежность, требования ИБ и законодательства, фазы луны.

Тип платформы:

- физические сервера;
- паравиртуализация;
- виртуализация уровня ОС;

Задачи:

- высоконагруженная база данных MySql, критичная к отказу;
- различные web-приложения;
- Windows-системы для использования бухгалтерским отделом;
- системы, выполняющие высокопроизводительные расчёты на GPU.

Объясните критерии выбора платформы в каждом случае.

---

## Решение 2

1. Высоконагруженная база данных MySql, критичная к отказу.

Высоконагруженные БД не рекомендуется размещать в контейнерах. Самым подходящим вариантом будет сборка отказоустойчивого кластера из физических серверов с соблюдением необходимого количества ядер и оперативной памяти. Для минимизации задержек при чтении/записи транзакций, можно попробовать дополнительно снизить нагрузку на хранилище данных. Запись логов и TEMP DB можно выделить на отдельные независимые друг от друга массивы RAID 10. Для TEMP хорошо подходит массив RAID 0, но в случаях, когда не позволителен простой более 10-15 минут, то массив RAID 10 хороший вариант для хранилищ с невысокой потребностью к объёму, но требовательный к скорости. Разбиение массивов позволяет снизить количество операций на основной массив данных, куда БД пишет основные транзакции данных. 
   
2. Различные web-приложения.

Для web-приложений идеальный вариант — это контейнеризация. Быстрое развёртывание, возможность нарастить дополнительные мощности при повышении нагрузки при пиках на web-сервисы. В дополнение можно указать, что контейнеры легко мигрировать на другую платформу при обновлении инфраструктуры или версионности приложения. 
   
3. Windows-системы для использования бухгалтерским отделом.

Для Windows систем, сама компания разработала не вполне не плохой вариант в лице Hyper-V. К примеру, для организации корпоративной среды в лице AD, DNS, DHCP, Configuration manager, Data Protection manager и так далее. Достаточно подготовить гостевые ВМ на хосте, где развёрнут гипервизор Hyper-V, выделить серверным ВМ отдельный vLan и развивать инфраструктуру по мере требования бизнеса. Также прекрасно подойдут другие продукты гипервизора VMware, XEN, Citrix. 
 
4. Системы, выполняющие высокопроизводительные расчёты на GPU.

Задачи по графике достаточно специфические и требовательны к скорости. В связи с этим, хорошим вариантом будет кластер из физических серверов с графическими ускорителями/картами.

---

## Задача 3

Выберите подходящую систему управления виртуализацией для предложенного сценария. Опишите ваш выбор.

Сценарии:

1. 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based-инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.
2. Требуется наиболее производительное бесплатное open source-решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.
3. Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows-инфраструктуры.
4. Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.

---

1. Гипервизоры WMVare подойдёт под данную задачу, позволит настроить кластеризацию при необходимости, настроить репликацию данных, резервирование данных и другие требования в зависимости из требований бизнеса.
2. KVM или XEN являются бесплатными open-source решениями и поддерживаются сообществом разработчиков. Поддерживает Linux и Windows подобные ОС, что позволит построить требуемую небольшую инфраструктуру.
3. Hyper-V Server гипервизор, который идёт в комплекте с ОС Windows Server и полностью подойдёт к инфраструктуре, построенной на Windows.
4. Hyper-V и Virtual Box на сегодня отличные варианты для создания рабочего окружения на рабочем или домашнем ПК. Hyper-V идёт в комплекте с ОС Windows10/11, необходимо лишь включить требуемую функцию в ОС. Virtual Box отличная альтернатива для подобных требований к гостевым ОС в рамках рабочей станции или домашнего ПК.


---

## Задача 4

Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был выбор, создавали бы вы гетерогенную среду или нет?

---

## Решение 4

Поддержка нескольких гипервизоров усложняет администрирование, а также выдвигают больше требований к кадрам. Основная проблема гибридов, это практическая сложность в миграции машин между средами, отсутствие возможности беспрерывной миграции (live migration). Требуется остановка виртуальной машины, другими словами остановка сервиса, далее попытка конвертации машины на поддерживаемый тип для гипервизора, куда необходимо мигрировать виртуальную машину, и только в случае успеха конвертации, сама миграция и последующий запуск виртуальной машины. При таких манипуляциях, часто выпадает BSOD, так как разница может быть не только в гипервизорах, а также в версиях самих виртуальных машин. К примеру поколение 1 Hyper-V при конвертации в VMware версии 8 с большей долей вероятность будет неуспешным. В дополнении ко всему необходимо учитывать размер виртуального диска конвертируемой виртуальной машины, если объём превышает 1ТБ, сама процедура конвертация может занять более суток, что для бизнеса часто бывает просто непозволительной роскошью. 

Такие распространённые гипервизоры как VMware, Citrix, XEN, Hyper-V могут предоставить универсальную площадку для разных типов ОС, в связи с этим на практике лучше ограничится одним гипервизором для удобства администрирования и минимизации к трудозатратам и требований к рабочим кадрам. 

В случае инфраструктуры on-premise дополнительным плюсом будет, ограничится одинаковыми серверными моделями с плановым ростом на 5 лет для унификации ЗИП, установки прошивок на серверное железо, и возможности масштабирования в случаях непредвиденного увеличения нагрузки или же резкого роста требований бизнеса к развитию.

**Примечание:** На конец 2023 года, удалось немного поработать с гипервизорами от российский вендоров, Горизонт-ВС, Брест и zVirt. Данные продукты показались мне вполне рабочими, есть свои нюансы, к примеру, Горизонт-ВС дорогой как боинг, Брест сыроват, Астра обещает допилить так как госы сидят на ней не мало так, а вот на удивление zVirt показался крепким середнячком, что очень порадовало.

