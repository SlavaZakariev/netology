## 15.1 Типы и структура СУБД - Вячеслав Закариев

### Введение

Перед выполнением задания вы можете ознакомиться с [дополнительными материалами](https://github.com/netology-code/virt-homeworks/tree/virt-11/additional).

---

### Задача 1

Архитектор ПО решил проконсультироваться у вас, какой тип БД лучше выбрать для хранения определённых данных.

Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:

- электронные чеки в json-виде
- склады и автомобильные дороги для логистической компании
- генеалогические деревья
- кэш идентификаторов клиентов с ограниченным временем жизни для движка аутентификации
- отношения клиент-покупка для интернет-магазина

Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.

---

### Решение  1

- Для данных электронные чеки в json-виде подойдёт MongoDB - Документно-ориентированная СУБД. На сегодня данная СУБД полностью поддерживает JSON, обрабатывает данные в формате JSON без нагрузки на преобразование данных между различными форматами.

- Склады и автомобильные дороги для логистической компании подпадают под данные, которые требуется структурировать, поэтому вариант с реляционной СУБД будет иметь место. PostgreSQL отличный вариант из современных реляционных СУБД.

- Для данных под генеалогические деревья, подойдёт графовая СУБД. К примеру, Neo4j, данный тип СУБД отличается от реляционных баз данных тем, что хранит данные в виде узлов и связей между ними, что позволяет эффективно моделировать и анализировать связи между сущностями.

- Для Кэша можно рассмотреть такие СУБД как Redis или Memcached. Данные инструменты хранят данные в оперативной памяти и обеспечивают высокую доступность быстрых данных, что в свою очередь повышает производительность системы.

- Реляционные СУБД подходят под данные отношения клиент-покупка для интернет-магазина. Ранее упомянутая СУБД PostgreSQL предоставляет возможность чёткого построения связей между таблицами, что удобно для хранения информации о покупках клиентов и поиска данных в долгосрочной перспективе за разные периоды.

---

### Задача 2

Вы создали распределённое высоконагруженное приложение и хотите классифицировать его согласно CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если (каждый пункт — это отдельная реализация вашей системы и для каждого пункта нужно привести классификацию):

- данные записываются на все узлы с задержкой до часа (асинхронная запись)
- при сетевых сбоях система может разделиться на 2 раздельных кластера
- система может не прислать корректный ответ или сбросить соединение

Согласно PACELC-теореме, как бы вы классифицировали эти реализации?

---

### Решение  2

Классификация системы по CAP-теореме:

В ситуации распределенности данных возможны сбои в сети, отключения серверов, ошибки при передаче данных и т.д. Все это не гарантирует одинаковые данные на всех узлах, что приводит к разночтениям в данных. Система остаётся доступной при сбое одного из узлов, нагрузка на чтение распределяется, что ускоряет работу сервиса. В то же время, система доступна, но не всегда отправляет корректные ответы. 

1. Данные записываются на все узлы с задержкой до часа (асинхронная запись):

- Консистентность: не гарантируется идентичные данные на всех узлах
- Доступность: данные остаются доступны, даже в независимости от скорости записи данных
- Устойчивость к разделению: система может разделиться на 2 раздельных кластера при сбое

2. При сетевых сбоях система может разделиться на 2 раздельных кластера:

- Консистентность: не гарантируется согласованность данных между кластерами
- Доступность: данные остаются доступны для каждого из 2 кластеров независимо
- Устойчивость к разделению: система может допускать разделение на 2 раздельных кластера

3. Система может не прислать корректный ответ или сбросить соединение:

- Консистентность: не гарантируется обеспечение в точности данных и корректных ответов
- Доступность: данные могут быть доступны, но не всегда отправляет корректные ответы
- Устойчивость к разделению: система не гарантирует отсутствие разделения в данном условии

Классификация по PACELC-теореме:

**Partion Tolerance** (устойчивость к разделению): система может разделиться на 2 раздельных кластера при сетевых сбоях. \
**Availability** (доступность): система остается доступной для каждого из 2-х кластеров независимо. \
**Consistency** (консистентность): система не гарантирует согласованность данных между разделенными кластерами и может не обеспечивать точность данных и корректных ответов. \
**Elasticity** (масштабируемость): информации о масштабируемости в данном контексте не предоставлено. Latency (задержка): данные записываются на все узлы с задержкой до часа. 

Таким образом, классификация системы по PACELC-теореме, будет следующей: \
**PA/E/L/C** - доступность и устойчивость к разделению, не гарантируется консистентность и эластичность. Задержка до часа.

---

### Задача 3

Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?

---

### Решение  3

В одной системе сочетаться принципы BASE и ACID не могут, так как принципы являются противоположностями, и преследуют разные цели.

ACID - обеспечивает согласованность данных, изолированность, целостность и долгосрочное хранение транзакций. Данный подход ставит основной упор на надежность данных за счет чего обеспечивает согласованность данных в любой момент времени. Узким местом считается производительность при работе с большими объёмами данных.

BASE - ориентирован на обеспечении высокой доступности данных и их масштабируемости. В данному подходе допускается, что данные могут находиться в "мягком" состоянии, то есть в состоянии, которое может быть не совсем точным или актуальным в любой момент времени. Однако, постепенно состояние данных становится согласованным, когда система продолжает работу и данные обновляются.

---

### Задача 4

Вам дали задачу написать системное решение, основой которого бы послужили:

- фиксация некоторых значений с временем жизни
- реакция на истечение таймаута

Вы слышали о key-value-хранилище, которое имеет механизм Pub/Sub. Что это за система? Какие минусы выбора этой системы?

---

### Решение  4

**СУБД Redis** хранящая данные в виде пар ключ-значение в оперативной памяти подходит под данную задачу. Key-value-хранилище с механизмом Pub/Sub - это система, которая предоставляет возможность хранить данные в виде пар ключ-значение и подписываться на определенные события, которые происходят в хранилище.

Механизм Pub/Sub реализует модель сообщений публикации/подписки, в которой опубликованные сообщения подразделяются на каналы без указания того, какие там могут быть подписчики, если таковые имеются. Подписчики проявляют интерес к одному или нескольким каналам и получают только те сообщения, которые представляют интерес, не зная, какие есть издатели. Такое разделение издателей и подписчиков обеспечивает большую масштабируемость и более динамичную топологию сети.

Минусы:

- Если издатель выходит из строя, то он теряет всех своих подписчиков
- Издатель может перегрузить работой своих подписчиков, если данные публикуются быстрее, чем обрабатываются
- Сообщение удаляется из буфера издателя сразу после публикации, не зависимо от того, какому числу подписчиков оно доставлено и как быстро те сумели обработать это сообщение
- Все подписчики получат сообщение одновременно. Нет встроенного механизма подтверждения успешной обработки сообщения подписчиком. Если подписчик получил сообщение и не обработал до конца, то издатель не получает уведомление об этом. 

