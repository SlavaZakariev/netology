## 12.8 Резервное копирование баз данных - Вячеслав Закариев

### Задание 1. Резервное копирование

Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.
1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.
1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

*Приведите ответ в свободной форме.*

---

### Решение 1

1.1 Для надёжного резервного копирования баз данных, необходимо рассмотреть вариант с резервирование журнала транзакций кроме самой базы. На практике часто применяют полное резервное копирование базы в конце рабочего дня организации, но тут тоже необходимо выделить окно, так как после резервного копирования часто начинаются так называемые ночные процессы, репликации, сбор данных для аналитики, отчётности и другие процессы приёма и передачи данных внутри инфраструктуры компании. Ежедневная полная резервная копия, скажем ежедневно в 21:00, даёт уверенность в откате данных на предыдущий день. Конечно полные резервные копии занимают не малый объём, и по мере роста базы, растёт и резервная копия, невзирая на сжатие при резервировании. Также за практику часто применяют возможность хранения, полных копий за весь месяц, далее копия за каждое 1 число месяца за 3-5 календарных лет, то есть минимум по 12 полных копий в рамках года. Если база больших размеров, скажем более 5 ТБ и выше, то можно применить план копирования, полной резервной копии раз в неделю, скажем каждый понедельник и 6 копий дифференциальных копий со вторника по воскресенье.

1.2 Применять инструмент резервирования журнала транзакций, скажем каждый час, даёт уверенность откатиться на полную копии прошлого дня, как было выше упомянуто к 21:00 и наката инкрементальных копий журнала транзакций до последней существующей копии журнала. В данном случае, потеря может быть в отрезке до одного часа. Бывают за практику берут и более узкие окна журнала транзакций, каждые 30 минут, каждые 10 минут, тут много факторов зависит от имеющихся ресурсов хранилища, а также от критичности базы, и интенсивности записи в базу данных. К примеру, если в базе в основном запросы на чтение и запись происходит не более 1-2 раз в час, то смысл в копии журнала каждые 10 минут просто отпадает.

---

### Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).
2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

*Приведите ответ в свободной форме.*

---

### Решение 2

2.1 Резервирование и восстановление

Создание дампа:

```pg_dump dbname > ИмяФайла``` 

Утилита для резервного копирования базы данных PostgreSQL обеспечивает согласованное резервное копирование, даже если база данных используется, **pg_dump** не блокирует запросы на чтение и запись к базе данных. Можно применять различные ключи при резервировании с учётом требуемых задач при резервировании. **pg_dump** Резервирует только одну базу данных. К примеру, для резервного копирования всего кластера или глобальных объектов, общих для всех баз данных в кластере, используйте **pg_dumpall**.

Восстановление:

```pg_restore -d dbname ИмяФайла```

Утилита для восстановления базы данных PostgreSQL из резервной копии, созданного **pg_dump**. Архивные файлы позволяют **pg_restore** избирательно относиться к процессу восстановления, можно изменять порядок элементов перед восстановлением. Утилита позволяется принять различные ключи при восстановлении с учётом требуемых параметров при восстановлении.

---

### Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL. 
3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

*Приведите ответ в свободной форме.*

Задания, помеченные звёздочкой, — дополнительные, не обязательные к выполнению, и никак не повлияют на получение вами зачёта по домашнему заданию.
Вы можете их выполнить, если хотите глубже шире разобраться в материале.

---

### Решение 3

